# Руководство по разработке — VideoGymnast

Руководство по настройке окружения и распространённым проблемам.

Подготовка окружения
--------------------
1. Установите Python 3.10+.
2. Установите зависимости:
   pip install -r requirements.txt
3. Убедитесь, что ffmpeg доступен:
   - Поместите исполняемый файл ffmpeg в `resources/ffmpeg/bin/ffmpeg`
   - Или установите ffmpeg в систему (и при упаковке укажите путь в `core/config.py`)

Рабочие папки
------------
- INPUT — папка, в которую вы кладёте исходные видео
- OUTPUT — папка, куда будут складываться результаты

В режиме разработки (DEV) BASE_DIR указывает на корень проекта с добавлением `_test`, поэтому:
- Положите входные файлы в `src/_test/input` (или создайте соответствующие папки, приложение их создаст)

Запуск
-----
- Обычный запуск:
  python src/main.py

- Запуск с указанием логирования:
  python src/main.py -l debug

Ожидаемое поведение
-------------------
- Если в input нет новых файлов — будет выведено сообщение "Нет файлов для конвертации".
- Для каждого файла будет показана панель с исходным и итоговым разрешением/битрейтом и прогрессбар.
- По завершении будет сообщение ГОТОВО (зелёный) или ВНИМАНИЕ (жёлтый), если итоговое решение заменено исходником.

Типичные ошибки и решения
------------------------
1. "Ошибка чтения исходного файла" — pymediainfo не смог получить видео или аудио трек.
   - Проверьте целостность файла.
   - Убедитесь, что libmediainfo корректно установлена в системе (некоторые платформы требуют системных библиотек).

2. ffmpeg не найден / не запускается
   - Проверьте путь `resources/ffmpeg/bin/ffmpeg`.
   - Убедитесь, что у исполняемого файла права на выполнение.

3. Итоговый файл больше исходного
   - Это ожидаемое поведение. В таком случае результат заменяется на копию исходника, чтобы избежать увеличения объёма.

Советы по настройке
-------------------
- Для контроля размера итогового файла можно подправить коэффициенты BPP в `core/config.py`.
- Для изменения предустановок x264 — поправьте `FFMPEG_X264_PRESET` в `core/config.py` или логику `compile_cmd`.

FAQ
---
Q: Можно ли ускорить обработку параллельно на нескольких ядрах?
A: Текущая реализация запускает ffmpeg последовательно по каждому файлу. Для параллельной обработки требуется доработать MainService/MessageBus (например, запускать несколько воркеров TranscoderService).

Q: Можно ли использовать hardware encoding?
A: Да, это возможно путём изменения compile_cmd и добавления соответствующих опций кодека (например, `h264_nvenc`). Учтите, что тогда потребуется проверка совместимости с аппаратным обеспечением.
